!function(t){"use strict";function e(e,i){return this.$target=t(e),this.opts=t.extend({},r,i),void 0===this.isOpen&&this._init(),this}var i,o,s,h,n,a,r={loadingNotice:"Loading image",errorNotice:"The image could not be loaded",errorDuration:2500,preventClicks:!0,onShow:void 0,onHide:void 0};e.prototype._init=function(){var e=this;this.$link=this.$target.find("a"),this.$image=this.$target.find("img"),this.$flyout=t('<div class="easyzoom-flyout" />'),this.$notice=t('<div class="easyzoom-notice" />'),this.$target.on("mouseenter.easyzoom touchstart.easyzoom",function(t){e.isMouseOver=!0,t.originalEvent.touches&&1!==t.originalEvent.touches.length||(t.preventDefault(),e.show(t,!0))}).on("mousemove.easyzoom touchmove.easyzoom",function(t){e.isOpen&&(t.preventDefault(),e._move(t))}).on("mouseleave.easyzoom touchend.easyzoom",function(){e.isMouseOver=!1,e.isOpen&&e.hide()}),this.opts.preventClicks&&this.$target.on("click.easyzoom","a",function(t){t.preventDefault()})},e.prototype.show=function(t,e){var n,a,r,d,c=this;return this.isReady?(this.$target.append(this.$flyout),n=this.$target.width(),a=this.$target.height(),r=this.$flyout.width(),d=this.$flyout.height(),i=this.$zoom.width()-r,o=this.$zoom.height()-d,s=i/n,h=o/a,this.isOpen=!0,this.opts.onShow&&this.opts.onShow.call(this),void(t&&this._move(t))):void this._load(this.$link.attr("href"),function(){(c.isMouseOver||!e)&&c.show(t)})},e.prototype._load=function(e,i){var o=new Image;this.$target.addClass("is-loading").append(this.$notice.text(this.opts.loadingNotice)),this.$zoom=t(o),o.onerror=t.proxy(function(){var t=this;this.$notice.text(this.opts.errorNotice),this.$target.removeClass("is-loading").addClass("is-error"),this.detachNotice=setTimeout(function(){t.$notice.detach(),t.detachNotice=null},this.opts.errorDuration)},this),o.onload=t.proxy(function(){o.width&&(this.isReady=!0,this.$notice.detach(),this.$flyout.html(this.$zoom),this.$target.removeClass("is-loading").addClass("is-ready"),i())},this),o.style.position="absolute",o.src=e},e.prototype._move=function(t){if(0===t.type.indexOf("touch")){var e=t.touches||t.originalEvent.touches;n=e[0].pageX,a=e[0].pageY}else n=t.pageX||n,a=t.pageY||a;var r=this.$target.offset(),d=a-r.top,c=n-r.left,l=Math.ceil(d*h),u=Math.ceil(c*s);0>u||0>l||u>i||l>o?this.hide():this.$zoom.css({top:""+-1*l+"px",left:""+-1*u+"px"})},e.prototype.hide=function(){this.isOpen&&(this.$flyout.detach(),this.isOpen=!1,this.opts.onHide&&this.opts.onHide.call(this))},e.prototype.swap=function(e,i,o){this.hide(),this.isReady=!1,this.detachNotice&&clearTimeout(this.detachNotice),this.$notice.parent().length&&this.$notice.detach(),t.isArray(o)&&(o=o.join()),this.$target.removeClass("is-loading is-ready is-error"),this.$image.attr({src:e,srcset:o}),this.$link.attr("href",i)},e.prototype.teardown=function(){this.hide(),this.$target.removeClass("is-loading is-ready is-error").off(".easyzoom"),this.detachNotice&&clearTimeout(this.detachNotice),delete this.$link,delete this.$zoom,delete this.$image,delete this.$notice,delete this.$flyout,delete this.isOpen,delete this.isReady},t.fn.easyZoom=function(i){return this.each(function(){var o=t.data(this,"easyZoom");o?void 0===o.isOpen&&o._init():t.data(this,"easyZoom",new e(this,i))})},"function"==typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports&&(module.exports=e)}(jQuery);